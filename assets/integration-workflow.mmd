flowchart LR
    subgraph Input Sources
        Video[Video File]
        Stream[RTSP Stream]
        WebRTC[WebRTC Conference]
        Mic[Microphone]
    end

    subgraph Processing
        FFmpeg[FFmpeg<br/>Audio Extraction]
        AudioProc[Audio Processing<br/>16kHz PCM Conversion]
    end

    subgraph Transcription Backend
        WS1[WebSocket<br/>Voxtral :5000]
        WS2[WebSocket<br/>Whisper :5001]
        WS3[WebSocket<br/>Parakeet :5002]
    end

    subgraph Output
        SRT[SRT Subtitles]
        Live[Live Captions]
        API[REST API Response]
        DataChannel[WebRTC Data Channel]
    end

    Video --> FFmpeg
    Stream --> FFmpeg
    WebRTC --> AudioProc
    Mic --> AudioProc

    FFmpeg --> AudioProc

    AudioProc --> WS1
    AudioProc --> WS2
    AudioProc --> WS3

    WS1 --> SRT
    WS1 --> Live
    WS1 --> API
    WS1 --> DataChannel

    WS2 --> SRT
    WS2 --> Live
    WS2 --> API

    WS3 --> Live
    WS3 --> DataChannel

    style Video fill:#4a9eff,stroke:#1e3a8a,stroke-width:3px,color:#fff
    style FFmpeg fill:#fbbf24,stroke:#92400e,stroke-width:3px,color:#000
    style AudioProc fill:#34d399,stroke:#065f46,stroke-width:3px,color:#000
    style WS1 fill:#fb923c,stroke:#9a3412,stroke-width:3px,color:#000
    style WS2 fill:#34d399,stroke:#065f46,stroke-width:3px,color:#000
    style WS3 fill:#a78bfa,stroke:#5b21b6,stroke-width:3px,color:#fff
    style SRT fill:#f87171,stroke:#991b1b,stroke-width:3px,color:#fff
    style Live fill:#f87171,stroke:#991b1b,stroke-width:3px,color:#fff
